<!DOCTYPE html>
<meta charset="utf-8">
<title>Geographic Clipping of Square</title>
<style>
  path {
    fill: none;
    stroke: #000;
  }
</style>
<body>
<script src="../../d3.v2.js"></script>
<script src="resample.js"></script>
<script>
var xy = d3.geo.azimuthal().scale(200).mode("orthographic").origin([0, 0]),
    circle = d3.geo.circle().origin([0, 0]),
    path = d3.geo.path().projection(xy),
    mercatorPath = d3.geo.path().projection(d3.geo.mercator().scale(200)),
    svg = d3.select("body").append("svg");

var origin = [0, 0],
    velocity = [-.01, .01];

var square = [d3.geo.resample([
  [  -5,  5],
  [ -90, 85],
  [-175,  5],
  [ 175,  5],
  [  90, 85],
  [   5,  5],
  [   0,  5],
  [  -5,  5]
])];

svg.append("path")
    .datum({type: "Polygon", coordinates: square})
    .style("stroke", "#f00");

d3.timer(step);

function step(t) {
  var o = [origin[0] + t * velocity[0], origin[1] + t * velocity[1]];
  xy.origin(o);
  circle.origin(o);
  svg.selectAll("path").attr("d", function(d) { return path(circle.clip(d)); });
}

</script>
